{% extends 'base.html.twig' %}

{% block body %}
    
    <div class="row">
		<!-- /.col -->
	    <div class="col-md-12">
	      <div class="box box-primary">
	        <div class="box-body no-padding">
	          <!-- THE CALENDAR -->
	          <div id="calendar"></div>
	        </div>
	        <!-- /.box-body -->
	      </div>
	      <!-- /. box -->
	    </div>
	    <!-- /.col -->
    </div>

    <div id="myModal" class="modal fade">
	    <div class="modal-dialog">
	        <div class="modal-content">
	        	<form role="form" method="POST" name="evento" id="evento" action="{{ path('evento_create') }} ">
		            <div class="modal-header">
		                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
		                <h4 class="modal-title"><!----></h4>
		            </div>
		            <div class="modal-body">
		            	<div class="form-group">
		                  <!--<label for="nombre">Nombre</label>-->
		                  <input type="hidden" class="form-control" id="nombre" name="nombre">
		                  <input type="hidden" class="form-control" id="fecha" name="fecha">
		                  <input type="hidden" class="form-control" id="reg_asistencia" name="reg_asistencia">
		                </div>
			            <div class="row">
			            	<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
				                <div class="form-group">
				                  <label for="tipo">Tipo de actividad:</label>
				                  <select class="form-control" id="tipo_actividad" name="tipo_actividad">
				                    {{tipo_actividad_html|raw}}
				                  </select>
				                </div>
			            	</div>
			            	<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
			            		<div class="form-group">
			            			<label for="tipo">Tipo de persona:</label>
				            		<div class="controls">
							          <label class="radio-inline">
							            <input type="radio" name="tipo_persona" id="tipo_persona_general" value="general" checked="checked">
							            General
							          </label>
							          <label class="radio-inline">
							            <input type="radio" name="tipo_persona" id="tipo_persona_dirigente" value="dirigente">
							            Dirigentes
							          </label>
							        </div>
							    </div>
			            	</div>
			            </div>
		                <div class="row">
			                <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
			                	<div class="bootstrap-timepicker">
				                  	<div class="form-group">
					                  <label for="hora_inicio">Hora Inicio:</label>
					                  <div class="input-group">
						                  <input type="text" class="form-control timepicker" id="hora_inicio" name="hora_inicio" placeholder="Hora Inicio">
						                  <div class="input-group-addon">
						                     <i class="fa fa-clock-o"></i>
						                  </div>
						              </div>
					                </div>
					            </div>
			                </div>
			                <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
			                	<div class="bootstrap-timepicker">
					                <div class="form-group">
					                  <label>Hora Fin:</label>
					                  <div class="input-group">
					                    <input type="text" class="form-control timepicker" name="hora_final" id="hora_final" placeholder="Hora Final">
					                    <div class="input-group-addon">
					                      <i class="fa fa-clock-o"></i>
					                    </div>
					                  </div>
					                </div>
					              </div>
			                </div>
			                <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
			                	<div class="form-group">
					                <label>Fecha Hasta:</label>
					                <div class="input-group date">
					                  <div class="input-group-addon">
					                    <i class="fa fa-calendar"></i>
					                  </div>
					                  <input type="text" class="form-control pull-right datepicker" id="fecha_hasta" name="fecha_hasta">
					                </div>
					            </div>
			                </div>

			               

			            </div>
		                <div class="form-group">
		                  <label for="detalle">Detalles:</label>
		                  <textarea class="form-control" id="detalle" name="detalle" rows="4" placeholder="Escriba el detalle del evento"></textarea>
		                </div>
		                <div class="form-group">
		                <fieldset>
		                	<legend class="form-group"><label for="condicion">Estado</label></legend>
		                		<div class="controls">
			                    <label class="radio-inline"><input type="radio" name="condicion" id="cond_porconfirmar" value="porconfirmar" checked="checked"></input>Por confirmar</label>&nbsp;&nbsp;&nbsp;
			                    <label class="radio-inline"><input type="radio" name="condicion" id="cond_confirmado" value="confirmado"></input>Confirmado</label>&nbsp;&nbsp;&nbsp;
			                    <label class="radio-inline"><input type="radio" name="condicion" id="cond_realizandose" value="realizandose"></input>Realizandose</label>&nbsp;&nbsp;&nbsp;
			                    <label class="radio-inline"><input type="radio" name="condicion" id="cond_finalizo" value="finalizo"></input>Finaliz√≥</label>&nbsp;&nbsp;&nbsp;
			                    <label class="radio-inline"><input type="radio" name="condicion" id="cond_cancelado" value="cancelado"></input>Cancelado</label>
			                    </div>
		                </fieldset>
		                  
		                </div>
			            
		            </div>
		           
		            <div class="modal-footer">
		                <button type="button" class="btn btn-default pull-left" data-dismiss="modal" id="cerrar">Cerrar</button>
		                <button type="button" class="btn btn-danger pull-center" values="registrar_asistencia" id="guardar_registrar_asistencia" name="enviar">Guardar y Registrar Asistencia</button>
		                <button type="submit" class="btn btn-primary pull-right" id="enviar" name="enviar">Guardar</button>
	              </div>
	            </form>
	        </div>
	    </div>
	</div>

{% endblock %}

{% block javascripts %}
	{{ parent() }}
<script type="text/javascript">
   $(document).ready(function(){
    	
    	
    	
	    //Date for the calendar events (dummy data)
	    var date = new Date();
	    var d = date.getDate(),
	        m = date.getMonth(),
	        y = date.getFullYear();

	    //console.log(new Date(y, m, 1));


	    $('#calendar').fullCalendar({
		    buttonHtml: {
				prev: '<i class="ace-icon fa fa-chevron-left"></i>',
				next: '<i class="ace-icon fa fa-chevron-right"></i>'
			},
	      header: {
	        left: 'prev,next today',
	        center: 'title',
	        right: 'month,agendaWeek,agendaDay'
	      },
	      buttonText: {
	        today: 'today',
	        month: 'month',
	        week: 'week',
	        day: 'day'
	      },
	      css:{
	      	margin:'5px'
	      },
	      //Random default events
	      events: {{eventos|raw}},
	      editable: false,
	      droppable: false, // this allows things to be dropped onto the calendar !!!
	      drop: function (date, allDay) { // this function is called when something is dropped

	        // retrieve the dropped element's stored Event Object
	        var originalEventObject = $(this).data('eventObject');

	        // we need to copy it, so that multiple events don't have a reference to the same object
	        var copiedEventObject = $.extend({}, originalEventObject);

	        // assign it the date that was reported
	        copiedEventObject.start = date;
	        copiedEventObject.allDay = allDay;
	        copiedEventObject.backgroundColor = $(this).css("background-color");
	        copiedEventObject.borderColor = $(this).css("border-color");
	        copiedEventObject.css({'margin':'20px'});

	        // render the event on the calendar
	        // the last `true` argument determines if the event "sticks" (http://arshaw.com/fullcalendar/docs/event_rendering/renderEvent/)
	        $('#calendar').fullCalendar('renderEvent', copiedEventObject, true);

	        // is the "remove after drop" checkbox checked?
	        if ($('#drop-remove').is(':checked')) {
	          // if so, remove the element from the "Draggable Events" list
	          $(this).remove();
	        }

	      },
	      eventRender: function(event, element)
		  { 
		  	var description = event.description;
		  	if (description.length >= 20) {
		  		description = description.substr(0, 20)+' ...';
		  	}

		  	var html_cont = '<div class="group-resumen">';
		  	html_cont +='<p class="resumen"><b>Hora: </b>'+event.hora_inicio+' - '+event.hora_final+'</p>';
		  	//html_cont += '<p class="resumen"><b>Det.: </b>'+description +'</p>';
		  	html_cont += '</div>';

		  	//agremaos resumen
		  	element.find('.fc-content').append(html_cont);

		  	if (event.condicion == 'porconfirmar' || event.condicion == 'cancelado') {

		  		var html_close = '<div class="box-tools pull-right closeon">';
			  	html_close += '<button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>';
			  	html_close += '</div>';

			  	element.find('.fc-content .fc-title').append(html_close);
			  	
		  	}
		  	
			//boton eliminar evento
			element.find(".closeon").on("click",function() {
               $('#calendar').fullCalendar('removeEvents',event._id);
               //console.log(event);
               $.ajax({
               	type: 'POST',
               	url: "{{ path('evento_delete') }}",
               	data: {'id':event.id_event},
               	success: function(data){
               		$('#calendar').fullCalendar('removeEvents',event._id);
               	}
               })
            });
		  },
          dayRender: function(date, cell){
		    var myDate = new Date();
            //dia agregados
            var daysToRest = 1;
			myDate.setDate(myDate.getDate() - daysToRest);

            if (date < myDate){
                $(cell).addClass('disabled');
            }
            else
            {
                //console.log("hoy o futuro");  
            } 
		  },
	      dayClick: function(date, jsEvent, view){

	      	var myDate = new Date();
            //dia agregados
            var daysToRest = 1;
			myDate.setDate(myDate.getDate() - daysToRest);

            if (date < myDate) {
                //console.log("pasado");
            }
            else
            {	
            	tooggle('enabled');
                //hoy o futuro
                var action = "{{ path('evento_create') }}";
	      	
		      	$("#myModal #evento").attr('action',action);

		      	$(".modal-title").html("Nuevo evento de calendario - "+date.format());
		    	$("#myModal .modal-body #fecha").val(date.format());
		    	$("#myModal .modal-body #fecha_hasta").val(date.format());

			    $("#myModal").modal('show');  
            } 

	      	
	      },
	      eventClick: function(calEvent, jsEvent, view){
	      	//console.log(calEvent);
	      	var myDate = new Date();
            //dia agregados
            var daysToRest = 1;
			myDate.setDate(myDate.getDate() - daysToRest);

            if (calEvent['start']._d < myDate) {
                //fechas pasadas
                $("#myModal .modal-title").html("<h3>Editar evento de calendario - "+calEvent['_start']._i+"</h3>");
                $("#myModal .modal-body #fecha").val(calEvent['_start']._i);
                $("#myModal .modal-body #nombre").val(calEvent['nombre']);
		    	$("#myModal .modal-body #tipo").val(calEvent['tipo']);
		    	$("#myModal .modal-body #hora_inicio").val(calEvent['hora_inicio']);
		    	$("#myModal .modal-body #hora_final").val(calEvent['hora_final']);
		    	$("#myModal .modal-body #detalle").val(calEvent['detalle']);

		    	$("#myModal .modal-body #tipo_persona_"+calEvent['tipo_persona']).prop('checked','checked');

		    	$("#myModal .modal-body #cond_"+calEvent['condicion']).prop('checked','checked');

		    	tooggle('disabled');
            }else{
            	var action = "{{ path('evento_index') }}";
	      	
		      	$("#myModal #evento").attr('action',action+calEvent['id_event']+'/update');

		      	$("#myModal .modal-title").html("<h3>Editar evento de calendario - "+calEvent['_start']._i+"</h3>");
		    	
		    	if (calEvent['condicion'] == 'porconfirmar') {

		    		tooggle('enabled');

		    		$("#myModal .modal-body #fecha").val(calEvent['_start']._i);
			    	$("#myModal .modal-body #tipo_actividad").val(calEvent['tipo_actividad']);
			    	$("#myModal .modal-body #hora_inicio").val(calEvent['hora_inicio']);
			    	$("#myModal .modal-body #hora_final").val(calEvent['hora_final']);
			    	$("#myModal .modal-body #detalle").val(calEvent['detalle']);

			    	$("#myModal .modal-body #tipo_persona_"+calEvent['tipo_persona']).prop('checked','checked');
			    	$("#myModal .modal-body #cond_"+calEvent['condicion']).prop('checked','checked');

			    	$("#myModal #enviar, #myModal #enviar").removeAttr('disabled').show();
			    	$("#myModal #enviar, #myModal #guardar_registrar_asistencia").removeAttr('disabled').show();
		    	}else{

		    		tooggle('disabled');

		    		//$("#myModal .modal-body input[type='radio']").removeAttr('disabled');

		    		$("#myModal .modal-body #fecha").val(calEvent['_start']._i);
			    	$("#myModal .modal-body #nombre").val(calEvent['nombre']);
			    	$("#myModal .modal-body #tipo_actividad").val(calEvent['tipo_actividad']);
			    	$("#myModal .modal-body #hora_inicio").val(calEvent['hora_inicio']);
			    	$("#myModal .modal-body #hora_final").val(calEvent['hora_final']);
			    	$("#myModal .modal-body #detalle").val(calEvent['detalle']);

			    	$("#myModal .modal-body #tipo_persona_"+calEvent['tipo_persona']).prop('checked','checked');

			    	$("#myModal .modal-body #cond_"+calEvent['condicion']).prop('checked','checked');

			    	$("#myModal .modal-body fieldset input[type='radio']").removeAttr('disabled');

			    	switch(calEvent['condicion']) {
					    case 'confirmado':
					        $("#myModal .modal-body #cond_porconfirmar").attr('disabled', 'disabled');
					        $("#myModal #enviar, #myModal #guardar_registrar_asistencia").show();
					        break;
					    case 'realizandose':
					        $("#myModal .modal-body #cond_porconfirmar").attr('disabled', 'disabled');
					        $("#myModal .modal-body #cond_confirmado").attr('disabled', 'disabled');
					        $("#myModal #enviar, #myModal #guardar_registrar_asistencia").show();
					        break;
					    case 'finalizo':
					        $("#myModal .modal-body input[type='radio']").attr('disabled','disabled');
					        $("#myModal #enviar, #myModal #guardar_registrar_asistencia").hide();
					        break;
					    case 'cancelado':
					        $("#myModal .modal-body input[type='radio']").attr('disabled','disabled');
					        $("#myModal #enviar, #myModal #guardar_registrar_asistencia").hide();
					        break;
					}

					if (calEvent['condicion'] == 'confirmado' || calEvent['condicion'] == 'realizandose') {
						$("#myModal #enviar, #myModal #enviar").removeAttr('disabled').show();
			    		$("#myModal #enviar, #myModal #guardar_registrar_asistencia").removeAttr('disabled').show();
					}
					

		    	}
		    	
            }
	    	
		    $("#myModal").modal('show');
	      }
	    });
		
	    //Timepicker
	    $(".timepicker").timepicker({
	      showInputs: false
	    });
	    //Date picker
	    var d = new Date();
	    var date_act = d.getDate()+'/'+d.getMonth()+'/'+d.getFullYear();
	    

	    $('.datepicker').datepicker({
	      autoclose: true,
	      dateFormat: "dd/mm/yyyy",
    	}).datepicker("setDate", date_act);

    	$( "#guardar_registrar_asistencia").click(function(e) {
    		e.preventDefault();
    		$("#reg_asistencia").val('REG_ASISTENCIA');
		  	$("#evento" ).submit();
		});

    	//Function disabled and enabled
    	tooggle = function(action){

    		if (action == 'disabled') {
    			$( "#myModal :input" ).attr('disabled','disabled');
    			$("#myModal #cerrar").removeAttr('disabled');
		    	$("#myModal #guardar_registrar_asistencia").hide();
		    	$("#myModal #enviar").hide();
    		}else{
    			$( "#myModal :input" ).removeAttr('disabled');
    			$("#myModal #guardar_registrar_asistencia").removeAttr('disabled').show();
		    	$("#myModal #enviar").removeAttr('disabled').show();
    		}
    	}
	 });
    </script>
{% endblock %}